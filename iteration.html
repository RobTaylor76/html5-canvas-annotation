<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="js/RequestAnimationFrame.js"></script>
    <script src="js/ImageResizer.js"></script>
    <script src="js/lineDrawing.js"></script>
    <style>

        .outsideWrapper{

        }
        .insideWrapper{

            position:relative;
        }
        .coveredImage{

            position:absolute;
            top:0px;
            left:0px;
            z-index:1;
        }
        .coveringCanvas{
            position:relative;
            z-index:20;
        }

        </style>
</head>
<body>
<h1>Hi</h1>



<script>

    var lineDrawing = new LineDrawing({strokeStyle: "#de0a3e",lineWidth: 5});

    $(function() {
        createLayout();
        bindEvents();
    });


    function createLayout() {
        var aHTML = [];
        aHTML.push(	'<h2>Select Picture or Take a Photo</h2>' +
            '<div>' +
            '<input accept="image/*" id="takePictureInput" type="file" />' +
            '</div>' +
            '<div id="imageContainer" >' +
            '<img id="yourImageSmall" alt="" />' +
            '</div>' +
            '<div class="outsideWrapper">' +
            '<div class="insideWrapper" id ="insideWrapper">' +
            '<img id="loadedImage" class="coveredImage">' +
            '</div>' +
            '</div>' +


            '<h2>Annotate on Image</h2>' +
            '<div id="annotationDrawingTools"></div>' +
            '<div id="myAnnotation"></div>' +
            '<button id="combineButton">Combine</button>' +
            '<h2>Final Image</h2>' +
            '<div id="myAnnotationResult"></div>');

        $('body').html(aHTML.join(''));
    }

    function drawCoverCanvas(dataURL) {

        var imageObj = new Image();
        imageObj.onload = function() {

            $('#loadedImage').attr('src', dataURL);

            $("#coverCanvas").remove(); // replace the canvas if it exists ...

            var canvas = $("<canvas id='coverCanvas'>")
                .attr({
                    width: imageObj.width,
                    height: imageObj.height
                })
                .addClass('coveringCanvas');

            $('#insideWrapper').append(canvas);

            lineDrawing.attachToCanvas(canvas.get(0));
        };
        imageObj.src = dataURL;
    }

    function bindEvents() {
        $('body').on("change", "#takePictureInput", function(event){
            var f = event.target.files[0];
    //        resetFields();

            // Only process image files.
            if(!f.type.match('image.*')) {

            }
            else {

                var resizer = new ImageResizer({
                    maxWidth: 1024,
                    quality: 0.90,
                    //timeout: 5000,
                    debug : true
                });
                resizer.handleFileSelection(f, drawCoverCanvas);
            }
        });
    }

    $('body').on("click", "#combineButton", function(event) {

        $("#combineCanvas").remove(); // replace the canvas if it exists ...

        var imageObj = new Image();
        imageObj.onload = function () {
            var canvas = $("<canvas id='combineCanvas'>").attr({
                width: imageObj.width,
                height: imageObj.height
            })[0];
            var context = canvas.getContext("2d");

            context.drawImage(imageObj, 0, 0);

            var coverCanvas = $("#coverCanvas")[0];

            context.drawImage(coverCanvas, 0, 0);


            $('#myAnnotationResult').append(canvas);
        };
        imageObj.src = $('#loadedImage')[0].src;
    });



</script>

</body>
</html>
